import{useState as n,useRef as t,useEffect as r,useCallback as e}from"react";import u from"next-tick";function c(){return c=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n},c.apply(this,arguments)}const i=i=>{const{done:o,drain:s,inflight:m,isPaused:g}=i;let{concurrency:h}=i;h<1&&(h=Infinity);const[l,a]=n({numPending:0,numInFlight:0,numDone:0}),p=t(!0),f=t([]),d=t([]);r(()=>{if(!g){if(l.numDone>0&&s&&0===f.current.length&&0===d.current.length&&!p.current)return p.current=!0,u(s);for(;f.current.length<h&&d.current.length>0;){p.current=!1;const n=d.current.shift();f.current.push(n),a(n=>c({},n,{numPending:n.numPending-1,numInFlight:n.numInFlight+1})),m&&m(c({},n,{stats:l}));const t=n.task();t.then(()=>{f.current.pop(),a(n=>c({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})),o&&o(c({},n,{result:t,stats:l}))}).catch(()=>{f.current.pop(),a(n=>c({},n,{numInFlight:n.numInFlight-1,numDone:n.numDone+1})),o&&o(c({},n,{result:t,stats:l}))})}}},[h,o,s,m,l]);const I=e(n=>{d.current.push(n),a(n=>c({},n,{numPending:n.numPending+1}))},[]);return{add:I,stats:l}};export{i as useRnAsyncQueue};
//# sourceMappingURL=use-rn-async-queue.modern.js.map
